<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Free service for producing online quizzes.">
        <meta name="keywords"
            content="quiz, quizzes, www, online quizzes, free quizzes, quizzes service, quizzes platform, квиз, чгк, что где когда, программа для чгк, онлайн-чгк, вопросы чгк, платформа для квизов, обработка ответов чгк">
        <meta name="author" content="Serhii Sabirov">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Open Quiz">
        <meta property="og:description" content="Free service for producing online quizzes.">
        <meta property="og:url" content="https://www.open-quiz.com">
        <meta property="og:site_name" content="Open Quiz">
        <meta property="fb:app_id" content="538011207113822" />
        <title>Open Quiz - Results</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.8.0/css/bulma.min.css">
        <link rel="icon" href="favicon.png" sizes="32x32" type="image/png">
        <link rel="stylesheet" type="text/css" href="/jquery-stickytable.css">
    </head>
<body>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="/jquery-stickytable.min.js"></script>
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous"
        src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&autoLogAppEvents=1&version=v6.0&appId=538011207113822"></script>
    <section class="hero is-shadowless is-fullheight">
        <div class="hero-head" style="display: none;">
            <div class="container">
                <nav class="navbar is-transparent is-spaced">
                    <div class="navbar-brand">
                            <div class="navbar-item navbar-logo" style="margin-right: auto;">
                                <figure class="image is-128x128"><img id="quizLogo" src="/logo.png" alt="logo" style="height: 128px; width: 128px; max-height: 128px"></figure>
                            </div>
                            <div id="quizName" class="navbar-item is-uppercase" style="margin: 20px; flex-shrink: initial;">
                                Quiz Name
                            </div>
                    </div>
                    <div class="navbar-menu">
                    </div>
                    <div class="navber-item" style="display: flex; align-items: center; margin-left: 5px;">
                        <div class="fb-like" data-href="https://www.open-quiz.com" data-width=""
                            data-layout="button_count" data-action="like" data-size="large" data-share="true"
                            data-colorscheme="light"></div>
                    </div>
                </nav>
            </div>
        </div>
        <div class="hero-body">
            <div id="mainContent" class="container" style="margin-bottom: auto">
<pre>
      ___
     &lt;o,q&gt;
     [`-']
     -"-"-
</pre>
            </div>
        </div>
        <div class="hero-foot has-background-dark has-text-grey-light" style="display: none;">
            <div class="container" style="text-align: center">&#169;<span class="is-hidden-touch"> Serhii Sabirov</span>
                2020/21 - <a href="/terms.html" class="has-text-grey-light">Terms</a> - <a href="/disclaimer.html"
                    class="has-text-grey-light">Disclaimer</a> - <a href="/privacy-policy-en.html"
                    class="has-text-grey-light">Privacy</a> - <a href="https://t.me/open_quiz"
                    class="has-text-grey-light">Contact</a></div>
        </div>
    </section>
<script>
(function($) {
    var re = /([^&=]+)=?([^&]*)/g;
    var decode = function(str) {
        return decodeURIComponent(str.replace(/\+/g, ' '));
    };
    $.parseParams = function(query) {
        var params = {}, e;
        if (query) {
            if (query.substr(0, 1) == '?') {
                query = query.substr(1);
            }

            while (e = re.exec(query)) {
                var k = decode(e[1]);
                var v = decode(e[2]);
                if (params[k] !== undefined) {
                    if (!$.isArray(params[k])) {
                        params[k] = [params[k]];
                    }
                    params[k].push(v);
                } else {
                    params[k] = v;
                }
            }
        }
        return params;
    };
})(jQuery);

function getL10n() {
    function getLang() {
        for (var i = 0; i < window.navigator.languages.length; i++) {
            var lang =  window.navigator.languages[i]
            if (lang.startsWith("en")) {return "en"}
            if (lang.startsWith("ru")) {return "ru"}
            if (lang.startsWith("uk")) {return "uk"}
            if (lang.startsWith("az")) {return "az"}
            if (lang.startsWith("uz")) {return "uz"}
        }
        return "en"
    }

    var lang = getLang()

    function l (en, ru, uk, az, uz){
        if (lang == "ru") { return ru }
        if (lang == "uk") { return uk }
        if (lang == "az") { return az }
        if (lang == "uz") { return uz }
        return en
    }

    var l10n = {
        results: l ("Results", "Результаты", "Результати", "Nəticələr", "Натижалар"),
        team: l ("Team", "Команда", "Команда", "Komanda", "Жамоа"),
        points: l ("Points", "Очки", "Очки", "Xallar", "Очколар"),
        ratingOfDifficulty: l ("Rating", "Рейтинг", "Рейтинг", "Reytinq", "Рейтинг"),
        place: l ("Place", "Место", "Місце", "Yer", "Ўрин"),
        questionDifficulty: l ("Question difficulty", "Сложность вопроса", "Складність питання", "Sualın mürəkkəbliyi", "Савол қийинлиги"),
        questionVotes: l ("Question karma", "Карма вопроса", "Карма питання", "Sualın karma", "Савол кармаси"),
        questionRating: l ("Question rating", "Рейтинг вопроса", "Рейтинг питання", "Sualın reytinqi", "Савол рейтинги"),
        toShortView: l ('less details', "скрыть детали", "сховати подробицi", "daha çox", "деталларни беркитиш"),
        toFullView: l ('more details', "показать детали", "показати подробицi", "daha az", "батафсил"),
        tour: l ('Tour', "Тур", "Тур", "Tur", "Босқич")
    }

    return l10n
}

function shortTable(data, l10n)
{
    var $topContainer = $('<div/>', {'style': 'display: grid'})
    var $container = $('<div/>', {'class': 'table-container'}).appendTo($topContainer)

    var toursCount = data.Questions.filter(function (obj) {return obj.EOT}).length

    if (data.Questions.length > 0 && !data.Questions[data.Questions.length - 1].EOT){
        toursCount = toursCount + 1
    }

    var $table = $('<table>', {'class': 'table is-hoverable'}).appendTo($container)
    var $hRow = $table.append('<thead>').children('thead').append('<tr/>').children('tr')

    $('<th>', {'text': '#'}).appendTo($hRow)
    $('<th>', {'text': l10n.team}).appendTo($hRow)
    if (toursCount > 1){
        for (var i = 0; i < toursCount; i++){
            $('<th>', {'text': l10n.tour + " " + (i + 1), 'style': 'white-space: nowrap; text-align: center'}).appendTo($hRow)
        }
    }
    $('<th>', {'text': l10n.points, 'style': 'text-align: center'}).appendTo($hRow)
    $('<th>', {'text': l10n.ratingOfDifficulty, 'style': 'text-align: center'}).appendTo($hRow)
    $('<th>', {'text': l10n.place, 'style': 'text-align: center'}).appendTo($hRow)


    var $body = $table.append('<tbody>').children('tbody')

    for (var i = 0; i < data.Teams.length; i++){
        var team = data.Teams[i]

        var $row = $('<tr/>')
            .append('<td>'+team.TeamId+'</td>')
            .append('<td>'+team.TeamName+'</td>');

        if (toursCount > 1){
            for (var j = 0; j < toursCount; j++){
                var tour = team.Tours[j]
                $('<td>', {'text': tour.Points, 'style': 'text-align: center'}).appendTo($row)
            }
        }

        $('<td>', {'text': team.Points, 'style': 'text-align: center'}).appendTo($row)
        $('<td>', {'text': team.Rating, 'style': 'text-align: center'}).appendTo($row)
        $('<td>', {'text': (team.PlaceFrom == team.PlaceTo) ? team.PlaceFrom : team.PlaceFrom + '-' + team.PlaceTo, 'style': 'text-align: center'}).appendTo($row)
        $body.append($row)
    }

    return $topContainer
}

function fullTable(data, l10n)
{
    var $topContainer = $('<div/>', {'style': 'display: grid'})
    var $container = $('<div/>', {'class': 'table-container'}).appendTo($topContainer)

    var $table = $('<table>', {'class': 'table is-hoverable is-fullwidth'}).appendTo($container)
    var $thead = $('<thead>').appendTo($table)
    var $hRow = $('<tr/>').appendTo($thead)
    $('<th>', {'text': '#'}).appendTo($hRow)
    $('<th>', {'text': l10n.team}).appendTo($hRow)
    for (var i = 0; i<data.Questions.length; i++){
        var qw = data.Questions[i]
        $('<th>', {'text': qw.Name, 'style': 'text-align: center;'}).appendTo($hRow)
    }
    $('<th>', {'text': l10n.points, 'style': 'text-align: center;'}).appendTo($hRow)
    $('<th>', {'text': l10n.ratingOfDifficulty, 'style': 'text-align: center;'}).appendTo($hRow)
    $('<th>', {'text': l10n.place, 'style': 'text-align: center;'}).appendTo($hRow)

    var $tbody = $('<tbody>').appendTo($table)

    // question's rating
    var $row = $('<tr/>');
    $('<td>').appendTo($row)
    $('<th>', {'text': l10n.questionDifficulty, 'style': 'white-space: nowrap; font-weight: normal; font-style: italic'}).appendTo($row)
    for (var j = 0; j<data.Questions.length; j++){
        $('<td>', {'text': data.Questions[j].Score, 'style': 'text-align: center; font-style: italic'}).appendTo($row)
    }
    $('<td>').appendTo($row)
    $('<td>').appendTo($row)
    $('<td>').appendTo($row)
    $tbody.append($row)

    var $row = $('<tr/>');
    $('<td>').appendTo($row)
    $('<th>', {'text': l10n.questionVotes, 'style': 'white-space: nowrap; font-weight: normal; font-style: italic'}).appendTo($row)
    for (var j = 0; j<data.Questions.length; j++){
        var karma = data.Questions[j].Votes
        var style = 'text-align: center; font-style: italic;'
        if (karma > 0) { style += 'color:green'}
        if (karma < 0) { style += 'color:red'}
        $('<td>', {'text': karma, 'style': style}).appendTo($row)
    }
    $('<td>').appendTo($row)
    $('<td>').appendTo($row)
    $('<td>').appendTo($row)
    $tbody.append($row)

    var $row = $('<tr/>');
    $('<td>',  {'style': 'border-bottom: double;'}).appendTo($row)
    $('<th>', {'text': l10n.questionRating, 'style': 'white-space: nowrap; font-weight: normal; font-style: italic; border-bottom: double;'}).appendTo($row)
    for (var j = 0; j<data.Questions.length; j++){
        var rating = data.Questions[j].Rating
        var style = 'text-align: center; font-style: italic; border-bottom: double black;'
        if (rating > 0) { style += 'color:green'}
        if (rating < 0) { style += 'color:red'}
        $('<td>', {'text': rating.toFixed(1), 'style': style}).appendTo($row)
    }
    $('<td>',  {'style': 'border-bottom: double;'}).appendTo($row)
    $('<td>',  {'style': 'border-bottom: double;'}).appendTo($row)
    $('<td>',  {'style': 'border-bottom: double;'}).appendTo($row)

    $tbody.append($row)

    for (var i = 0; i < data.Teams.length; i++){
        var team = data.Teams[i]

        var $row = $('<tr/>');
        $('<td>'+team.TeamId+'</td>').appendTo($row)
        $('<th>', {'text': team.TeamName, 'style': 'white-space: nowrap; font-weight: normal'}).appendTo($row)

        for (var j = 0; j<data.Questions.length; j++){
            var qw = data.Questions[j]
            var key = JSON.stringify(qw.Key)
            var details = team.Details[key]
            var txt = details ? details.Result : ""
            var style = "text-align: center;"
            if (qw.EOT) {style += 'border-right: dotted;'}
            $('<td>',  {'text': txt, 'style': style}).appendTo($row)
        }

        $('<td>', {'text': team.Points, 'style': 'text-align: center'}).appendTo($row)
        $('<td>', {'text': team.Rating, 'style': 'text-align: center'}).appendTo($row)
        $('<td>', {'text': (team.PlaceFrom == team.PlaceTo) ? team.PlaceFrom : team.PlaceFrom + '-' + team.PlaceTo, 'style': 'text-align: center'}).appendTo($row)

        $tbody.append($row)
    }

    return $topContainer
}
function displayResults (data, teamId, l10n, full) {
    var $menu = $('<div/>', {});
    if (full){
        $('<a>'+l10n.toShortView+'</a>').click(function() {displayResults(data, teamId, l10n, false)}).appendTo($menu)
    } else{
        $('<a>'+l10n.toFullView+'</a>').click(function() {displayResults(data, teamId, l10n, true)}).appendTo($menu)
    }

    $table = full ? fullTable(data, l10n) : shortTable(data, l10n)

    if (teamId){
        let $el = $table.find('tr td:first-child').filter(function() {
            return $(this).text() == teamId;
        }).parent()
        $el.find('td, th').css('font-weight', 'bold')
        $el
        .clone()
        .find('td, th').css('border-bottom', 'double')
        .parent()
        .prependTo($table.find('tbody'))
    }


    $('#mainContent').empty().append($menu).append($table)

    var vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)

    if (vw >= 800){
        $('#mainContent').find('table').stickyTable();
    }
}

$(document).ready(function() {
    var defaults = {quiz : 0, quizName : "", quizImg : "", teamId : 0, token : "", url: "https://www.open-quiz.com"}
    var parameters = $.parseParams(location.search.substring(1))
    var settings = $.extend({}, defaults, parameters);

    var l10n = getL10n()
    // alert(JSON.stringify(l10n))

    var title = settings.quizName + " - " + l10n.results
    document.title = title

    $("meta[name='description']").attr("content", title)
    $("meta[property='og\\:description']").attr("content", title)
    $("meta[property='og\\:url']").attr("content", window.location.href)

    if (settings.quizImg != ""){
        $("#quizLogo").attr("src", settings.url + "/media/" + settings.quizImg);
    }
    $("#quizName").text(settings.quizName);

    var isEmbeded = settings.who === "emb"
    if (!isEmbeded){
        $(".hero-head").show()
        $(".hero-foot").show()
    }

    var url = settings.url + "/static/" + settings.quiz + "-" + settings.token + "/results.json?nocache=" + (new Date()).getTime()
    $.getJSON(url, function(data) {displayResults(data, settings.teamId, l10n)});
});
</script>
</body>
</html>